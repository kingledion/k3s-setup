#!/bin/bash

# download and setup k3s
# options: 
#   - user docker instead of containerd
#   - make config file read and writable
#   - disable traefik ingress controller
curl -sfL https://get.k3s.io | sh -s - --docker --write-kubeconfig-mode 644 --disable traefik

# make sure ~/.kube exists; swallow error if it does
mkdir ~/.kube 2> /dev/null

# create kube config file (for use with helm)
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config

# remove group and world read premissions on kube config file
chmod u=rw ~/.kube/config